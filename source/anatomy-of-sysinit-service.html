<title>Anatomy of a sysinit service</title>
<link rel="Up" href="index.html" title="nosh Guide" />
<link rel="Prev" href="anatomy-of-system-target.html" title="Anatomy of a system target" />
<link rel="Next" href="creating-bundles.html" title="Creating bundles" />
<h1>
Anatomy of a sysinit service
</h1>

<p>
Various pre-packaged services are "sysinit" services, started as a result of being wanted by the "sysinit" target (either directly or indirectly via a targets such as "local-fs").
</p>

<p>
The machine-id service in the sysinit services collection is an example of a sysinit service.
Its <code>run</code>, <code>stop</code>, and <code>restart</code> programs are all fairly straightforward and self-explanatory.
And its <code>remain</code> flag file causes the service to be considered a "run on empty" service by the service manager, as a target is.
This is because the meat of the service is in its <code>start</code> program, run when the service is brought up from being down, as happens at boot time because the service (when enabled) is wanted by the "sysinit" target.
</p>

<p>
The <code>start</code> program runs the <a href="setup-machine-id.html"><code>setup-machine-id</code></a> utility.
This utility performs boot-time actions that set up the <code>/etc/machine-id</code> and <code>/run/machine-id</code> files.
</p>

<p>
Most "sysinit" services do their work in their <code>start</code> programs.
Only a few, such as the the plug and play manager service and its log service, have long-lived daemon processes.
</p>

<p>
The supervise directories for most "sysinit" services live under <code>/run</code> (more specifically usually <a href="gazetteer.html#early-supervise"><code>/run/service-bundles/early-supervise</code></a>), because they must be writable before the filesystem containing <code>/etc</code> is remounted read-write.
The service manager is told to load them, and thus needs to create their control/status API files, <a href="startup-and-shutdown.html#sysinit">first thing in the bootstrap procedure</a>.
</p>

<h2 id="etc">
"etc" sysinit services
</h2>

<p>
Some "sysinit" services live in <code>/etc/service-bundles/services</code>.
These are the "sysinit" services that are part of, or that precede, bringing up local filesystems; loaded in parallel with (or even before) mounting <code>/usr</code> and <code>/var</code>.
</p>

<p>
Apart from the plug and play manager service, the "etc" sysinit services all use one single sysinit-log logging service.
The plug and play manager service has its own logging service.
</p>

<p>
The logging services have to come up after the filesystem containing <code>/var/log</code> is available and writable.
Log data from the logged services sits in its input pipe until then.
The consequence of this is that too much log output from "etc" sysinit services has the potential to deadlock the system.
(Too much output from the plug and play manager service simply halts it until its log service comes up.
The plug and play manager usually isn't in the critical path for mounting <code>/var/log</code> read-write.)
</p>

<p>
So it is very important to minimize the amount of output generated by "etc" sysinit services.
</p>
