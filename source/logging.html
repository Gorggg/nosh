<title>Logging</title>
<link rel="Up" href="index.html" title="nosh Guide" />
<link rel="Prev" href="mounting.html" title="Mounting filesystems" />
<link rel="Next" href="timestamps.html" title="Timestamps" />
<h1>
Logging
</h1>

<p>
<a href="log-service-plumbing.html">Logging services are otherwise ordinary services that are plumbed to main services through pipes</a>.
</p>

<p>
<a href="beyond-cyclog.html">When <code>cyclog</code> isn't enough</a>.
</p>

<p>
<a href="old-log-services.html">Services for handling old log mechanisms</a>.
</p>

<h2>
Cheatsheet
</h2>

<h3>
Where your logs are
</h3>

<p>
The <code class='filename'>log/</code> symbolic link joins a main service bundle to a logging service bundle.
By convention, a further <code class='filename'>main/</code> symbolic link points to the main log output directory.
So if one has obtained the location of the dbus service bundle with <code>system-control find dbus</code> one can, by convention, append <code class='filename'>log/main/</code> to find its log files.
</p>

<ul>

<li>
<blockquote><pre>readlink `system-control find dbus`/log/main</pre></blockquote>
<p>
Where the log for the dbus service is.
</p></li>

<li>
<blockquote><pre>readlink `system-control find local-syslog-read`/log/main</pre></blockquote>
<p>
Where the output of C programs using the old <code>syslog()</code> mechanism is.
</p>
</li>

<li>
<blockquote><pre>readlink `system-control find klogd`/log/main</pre></blockquote>
<p>
Where the kernel log is.
</p>
</li>

</ul>

<h3>
A small list of useful commands relating to logging.
</h3>

<ul>

<li>
<blockquote><pre>system-control status devd</pre></blockquote>
<p>
Because the devd service has a <code class='filename'>log/main/</code> symbolic link, this command displays the last few lines of log output for the devd logging service.
</p>
</li>

<li>
<blockquote><pre>svc -a `system-control find devd`/log/</pre></blockquote>
<p>
Log services can be told to explicitly rotate their output files.
The major use case for this is to start a fresh <code>current</code> file for following as it is written.
</p>
</li>

<li>
<blockquote><pre>find `system-control find devd`/log/main/ -type f -mtime -1 -print0 | \
xargs -0 sort -m -- | \
tai64nlocal | \
${PAGER:-more}</pre></blockquote>
<p>
This finds the last 1 days' worth of log files in the "devd" log service's log output, combines them, decodes the timestamps, and paginates the result.
The TAI64N timestamp in log files is sortable, and lines are already sorted within each log file (by the nature of logging), so sorting together multiple logs (which the <code class='command'>find</code> command is not guaranteed to emit in order) can be done with the <code>-m</code> (merge sort) option to the <code class='command'>sort</code> command.
</p>
</li>

<li>
<blockquote><pre>tail -F `system-control find dbus`/log/main/current | tai64nlocal</pre></blockquote>
<p>
This command displays the output of a log as it is written.
The <code>-F</code> option to <code class='command'>tail</code> is the correct one to use, not the <code>-f</code> option.
</p>
</li>

<li>
<blockquote><pre>tail -F `system-control find dbus`/log/main/current | \
fgrep --line-buffered 'PackageKit' | \
tai64nlocal</pre></blockquote>
<p>
This command displays the filtered output of a log as it is written.
The <code>--line-buffered</code> option stops <code>fgrep</code> from batching up the filtered lines and only spitting them out in lumps.
</p>
</li>

</ul>
