<refentry id="login-process">

<refmeta><refentrytitle>login-process</refentrytitle><manvolnum>1</manvolnum><refmiscinfo class="manual">user commands</refmiscinfo><refmiscinfo class="source">nosh</refmiscinfo><refmiscinfo class="version">1.0</refmiscinfo></refmeta>

<refnamediv><refname>login-process</refname><refpurpose>chain-load utility for recording login processes in utmp/wtmp</refpurpose></refnamediv>

<refsynopsisdiv>
<refsection><title>MODERN BSD</title>
<cmdsynopsis>
<command>login-process</command>
<arg choice='req'><replaceable>next-prog</replaceable></arg>
</cmdsynopsis>
</refsection><refsection><title>OLD SYSTEM V</title>
<cmdsynopsis>
<command>login-process</command>
<arg>--utmp-filename <replaceable>filename</replaceable></arg>
<arg>--wtmp-filename <replaceable>filename</replaceable></arg>
<arg>--getty</arg>
<arg choice='req'><replaceable>next-prog</replaceable></arg>
</cmdsynopsis>
</refsection>
</refsynopsisdiv>

<refsection><title>Description</title>

<para>
<command>login-process</command> is a chain-loading utility that records itself
as a "login" process in the <filename>utmp</filename> and
<filename>wtmp</filename> databases, and then (if successful) chain loads to
<replaceable>next-prog</replaceable> with the
<citerefentry><refentrytitle>execvp</refentrytitle><manvolnum>3</manvolnum></citerefentry>
function.
Normally, the <replaceable>next-prog</replaceable> will be (or will eventually
chain-load)
<citerefentry><refentrytitle>login</refentrytitle><manvolnum>1</manvolnum></citerefentry>
and thus be the login process so recorded.
</para>

<para>
<replaceable>next-prog</replaceable> may contain its own command line options, which <command>login-process</command> will ignore.
</para>

<para>
<command>login-process</command> makes no alteration to process state.
</para>

<refsection><title>MODERN BSD BEHAVIOUR</title>

<para>
Modern BSD operating systems have a completely new user accounting database and
have no notion of "login" or "init" accounting entries at all
(see
<citerefentry><refentrytitle>utmpx</refentrytitle><manvolnum>3</manvolnum></citerefentry>).
This utility effectively does nothing on such operating systems.
</para>

</refsection><refsection><title>OLD SYSTEM V BEHAVIOUR</title>

<para>
The locations of the <filename>utmp</filename> and <filename>wtmp</filename> files are derived at compile time
from a system header when the utility is built from source.
To override them at runtime, use the <arg>--utmp-filename</arg> and <arg>--wtmp-filename</arg>
options.
</para>

<para>
<command>login-process</command> determines its own process ID and the basename of its
controlling TTY.  
Using those, it locates the appropriate record in <filename>utmp</filename> to overwrite,
which matches one or the other or both.
If it fails to find a match, it unconditionally extends <filename>utmp</filename> with a new
record.
It always extends <filename>wtmp</filename> with that same record.
</para>

<para>
The type of the record is set to <code>LOGIN_PROCESS</code> (see
<citerefentry><refentrytitle>utmpx</refentrytitle><manvolnum>3</manvolnum></citerefentry>)
and the username is set to "LOGIN", unless the <code>--getty</code> option is
used in which case the type is <code>INIT_PROCESS</code> and the username "GETTY".
The line is set to the basename of the controlling TTY, and the id is set
to whatever trailing numeric portion thereof exists.
(So, for example, if the controlling TTY is <filename>/dev/tty13</filename>, the line will be 
<code>tty13</code> and the id will be <code>13</code>.)
</para>

<para>
The name of the controlling TTY is determined from the value of the <code>TTY</code>
environment variable, if present.
This will be the case if <command>login-process</command> has been invoked within a chain
that has run 
<citerefentry><refentrytitle>vc-get-tty</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
<citerefentry><refentrytitle>pty-get-tty</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
or an equivalent 
<citerefentry><refentrytitle>getty</refentrytitle><manvolnum>1</manvolnum></citerefentry>
program.
If absent, the 
<citerefentry><refentrytitle>ttyname</refentrytitle><manvolnum>3</manvolnum></citerefentry>
library function is called.
</para>

<refsection><title>SECURITY</title>

<para>
The program requires permission to read and write to <filename>utmp</filename> and append (write) to <filename>wtmp</filename>.
Lack of permission will result in the program aborting with an error.
</para>

<para>
<command>login-process</command> is not responsible for erasing records from <filename>utmp</filename>.
That is done by <citerefentry><refentrytitle>init</refentrytitle><manvolnum>1</manvolnum></citerefentry> when it reaps a child.
If the process running <command>login-process</command> is not (at termination)
a descendant of
<citerefentry><refentrytitle>init</refentrytitle><manvolnum>1</manvolnum></citerefentry>,
the <filename>utmp</filename> record written will not be marked "dead".
Re-using the "undead" <filename>utmp</filename> records for dead processes that
<citerefentry><refentrytitle>init</refentrytitle><manvolnum>1</manvolnum></citerefentry>
never saw is why <command>login-process</command> also matches on the basename
of the controlling TTY.
</para>

</refsection><refsection><title>BUGS</title>

<para>
Although not strictly a bug in this program, it is worth mentionining here that
the <citerefentry><refentrytitle>who</refentrytitle><manvolnum>1</manvolnum></citerefentry> utility doesn't display the user name if the record type is
<code>INIT_PROCESS</code>.
</para>

</refsection></refsection></refsection><refsection><title>Author</title><para>Jonathan de Boyne Pollard</para></refsection>

</refentry>
